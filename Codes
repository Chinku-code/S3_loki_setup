---
apiVersion: v1
kind: Secret
metadata:
  name: loki-s3-secret
  namespace: openshift-logging
type: Opaque
stringData:
  # OCPlogs bucket credentials
  AWS_ACCESS_KEY_ID_OCPL: "TLSEH1755582HPCKSR30"        # replace with OCPlogs access key
  AWS_SECRET_ACCESS_KEY_OCPL: "tLSH1755582HPCS...Agp"   # replace with OCPlogs secret key

  # External Logging bucket credentials
  AWS_ACCESS_KEY_ID_EXT: "iSDFM17568E29GX2XFUB"         # replace with External Logging access key
  AWS_SECRET_ACCESS_KEY_EXT: "msXF48x12V...v_4"         # replace with External Logging secret key

  # Reports bucket credentials
  AWS_ACCESS_KEY_ID_REP: "LY2V17573F6ND04560"           # replace with Reports access key
  AWS_SECRET_ACCESS_KEY_REP: "38176d4qD9...D034"        # replace with Reports secret key

  AWS_REGION: "ap-south-1"
  AWS_ENDPOINT: "https://s3store-A9cl2-d.rbank.sbi"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: loki
  namespace: openshift-logging
data:
  loki.yaml: |
    auth_enabled: false

    server:
      http_listen_port: 3100

    schema_config:
      configs:
        - from: 2023-01-01
          store: boltdb-shipper
          object_store: s3
          schema: v11
          index:
            prefix: index_
            period: 24h

    storage_config:
      # Default OCPlogs bucket
      aws:
        s3: s3://$(AWS_ACCESS_KEY_ID_OCPL):$(AWS_SECRET_ACCESS_KEY_OCPL)@s3store-A9cl2-d.rbank.sbi/epay-dr-preprod-ocplogs
        bucketnames: epay-dr-preprod-ocplogs
        region: $(AWS_REGION)
        endpoint: $(AWS_ENDPOINT)
        insecure: false
      boltdb_shipper:
        shared_store: s3

    # You can add multiple tenants if you want to separate logs by bucket
    # Example: external-logging and reports can be separate tenants
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: loki
  namespace: openshift-logging
spec:
  template:
    spec:
      containers:
      - name: loki
        envFrom:
        - secretRef:
            name: loki-s3-secret
